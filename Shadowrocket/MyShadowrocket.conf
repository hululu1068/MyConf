# Shadowrocket 自用规则，含广告过滤和一些常用脚本
# 未配置[代理分组]，主要用于自配置节点
# by xjianglin
# Edit Time: UTC 2023-09-30
#
#
# GeoLite2 Country数据库【最好在‘设置’菜单填入】（切换配置文件不用二次输入）
# geoip-maxmind-url = https://github.com/P3TERX/GeoLite.mmdb/raw/download/GeoLite2-Country.mmdb
# GeoLite2 ASN数据库
# geoip-maxmind-url = https://github.com/P3TERX/GeoLite.mmdb/raw/download/GeoLite2-ASN.mmdb
#
# 图标备用
# 🇨🇳🇬🇧🇯🇵🇭🇰🇸🇬🇺🇸🇰🇷🇷🇺🇮🇳🇩🇪🇨🇦
# 🔨⚙️🎸🎵🎯♻️🚧💯🀄️🔔📡🎬📽🌏🚦🚥⛔️🈲🌐🕹🚀🧲🎮🎱
# 💻📲🎧🕸️💫💬💥🚫💡🎁📚🏡✉️🔖📪📬📮
# 👍👎👇👌🫶🙈🤫🌟
# 🐝🦁🐷🦒🐳🐼🐦🧸🐯🌵🦑🐶🍎🍐
[General]
# 
#################### 🔐以下为默认设置项 #####################
#
# 旁路系统(默认开启)
bypass-system = true
# 跳过代理。此选项强制这些域名或IP的连接范围由Shadowrocket TUN接口来处理，而不是Shadowrocket内核。此选项用于解决一些应用程序的一些兼容性问题。
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 17.0.0.0/8, ::1/128, fc00::/7, fd00::/8, fe80::/10, dd88:88:88:88::/64, localhost, *.local, *.lan, captive.apple.com, e.crashlynatics.com, cable.auth.com, teams.microsoft.com
# TUN旁路路由。Shadowrocket TUN接口只能处理TCP协议。使用此选项可以绕过指定的IP范围，让其他协议通过
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.168.0.0/16, 198.18.0.0/15, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32
# DNS 服务器
dns-server = 223.5.5.5, 119.29.29.29, https://doh.pub/dns-query, https://dns.alidns.com/dns-query
# IPv6 支持（默认关闭）
ipv6 = true
# IPv6 偏好（默认关闭）优先向IPv6的DNS服务器查询AAAA记录。优先使用AAAA记录。false表示不启用。
prefer-ipv6 = false
# DNS回退系统（默认开启）如果使用 DNS-Over-TLS, DNS-over-HTTPS 或者 DNS-over-QUIC 的域名查询因某种原因而失败, Shadowrocket 将退回并使用操作系统配置的默认 DNS,而不是显示错误.这里关闭
dns-fallback-system = false
# DNS直连系统。域名直接使用系统DNS进行解析。false表示不启用。
dns-direct-system = false
# 直接域解析失败后使用代理(默认true)
dns-direct-fallback-proxy = false
# ping数据包自动回复
icmp-auto-reply = true
# 始终拒绝 url 重写。不开启时，REJECT策略默认只有在配置模式下生效。开启后，可以令该策略在其他全局路由模式下都生效。
always-reject-url-rewrite = false
# 私有ip应答
private-ip-answer = true

#
####################### 🎁以下为个性化设置项 ######################
#
# 隐藏VPN标志符（默认关闭）
hide-vpn-icon = false
# ssid-suspended-list，让 Shadowrocket 在特定 Wi-Fi 网络下暂停工作(仅 task 模块会继续工作)，多个Wi-Fi用“,”连接
# 建议在‘设置-按需求连接’中添加
# ssid-suspended-list = MiRouter, MiRouter_5G
# DNS劫持。默认情况下，Shadowrocket 只返回发送到 Shadowrocket DNS 地址的 DNS 查询的假IP地址 (198.18.0.2)。有些设备或软件总是使用硬编码的DNS服务器。（例如NETFLIX、Google Speakers 总是使用 8.8.8.8)。你可以使用此选项劫持查询，以获得一个假地址。
hijack-dns = 8.8.8.8:853, 9.9.9.9:853, 1.1.1.1:853
# 从 /etc/hosts 读取 DNS 记录
read-etc-hosts = true
# 拒绝显示错误页面
show-error-page-for-reject = true
# All Hybrid 网络并发
all-hybrid = false
# 增强版 Wi-Fi 助理
allow-wifi-access = false
# WiFi辅助
wifi-assist = false
# 排除简单主机名
exclude-simple-hostnames = true
# 测试超时（秒）
test-timeout = 10
# Internet 测试 URL
internet-test-url = http://ipw.cn
# 代理测速 URL
proxy-test-url = http://www.gstatic.com/generate_204
# 不开启时，REJECT策略默认只有在配置模式下生效。开启后，可以令该策略在其他全局路由模式下都生效。
always-reject-url-rewrite = false
# 私有IP应答。如果不启用该选项，域名解析返回私有IP，Shadowrocket会认为该域名被劫持而强制使用代理。
private-ip-answer = true
# 总是返回真实IP的域名，针对游戏、智能家居
always-real-ip = *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, *.srv.nintendo.net, *.stun.playstation.net, xbox.*.microsoft.com, *.xboxlive.com, *.battlenet.com.cn, *.battlenet.com, *.blzstatic.cn, *.battle.net
#
#
#
[Replica]
# > 隐藏 Apple 请求
hide-apple-request = false
# > 隐藏崩溃追踪器请求
hide-crash-reporter-request = true
# > 隐藏 UDP 会话
hide-udp = false
# > 关键词过滤器
keyword-filter-type = true
#
#
###################### 📚规则 #####################
# 规则集引用自：https://github.com/blackmatrix7/ios_rule_script/tree/master/rule/Shadowrocket
#
# 👇如开启其他设置中的  “分流匹配优化” 选项，则匹配优先级为👇
# domain > domain-suffix > domain-keyword(wildcard) > geoip = ip-cidr > user-agennt
#
[Rule]
# 个人自定义👇
IP-CIDR,192.168.0.0/16,DIRECT
IP-CIDR,10.0.0.0/8,DIRECT
IP-CIDR,172.17.0.0/12,DIRECT
IP-CIDR,127.0.0.0/8,DIRECT
IP-CIDR,dd88:88:88:88::/64,DIRECT
DOMAIN-KEYWORD,torrent,DIRECT
DOMAIN-KEYWORD,tracker,DIRECT
DOMAIN-KEYWORD,SMTP,DIRECT
DOMAIN-KEYWORD,fdm,DIRECT
DOMAIN-KEYWORD,NetTransport,DIRECT
DOMAIN-KEYWORD,qbittorrent,DIRECT
DOMAIN-KEYWORD,thunder,DIRECT
DOMAIN-KEYWORD,transmission,DIRECT
DOMAIN-KEYWORD,uTorrent,DIRECT
DOMAIN-KEYWORD,WebTorrent,DIRECT

DOMAIN-SUFFIX,sanv.org,DIRECT
DOMAIN-SUFFIX,right.com.cn,DIRECT
DOMAIN-SUFFIX,dyndns.com,DIRECT
DOMAIN,api.webtest.net,DIRECT
DOMAIN,ip.istatmenus.app,DIRECT
DOMAIN-SUFFIX,istatmenus.app,DIRECT
DOMAIN-SUFFIX,skk.moe,DIRECT
DOMAIN,api.ipify.org,DIRECT
DOMAIN,ip.3322.net,DIRECT
DOMAIN,ip111.cn,DIRECT
DOMAIN,ipip.net,DIRECT
DOMAIN,ipinfo.io,DIRECT
DOMAIN-SUFFIX,digitalocean.com,DIRECT
DOMAIN-SUFFIX,imast.ml,DIRECT
DOMAIN-SUFFIX,parallels.cf,DIRECT
DOMAIN-SUFFIX,zeekr.cf,DIRECT
DOMAIN-SUFFIX,b3tter.eu.org,DIRECT
DOMAIN-SUFFIX,tikt0k.eu.org,DIRECT
DOMAIN-SUFFIX,iina.eu.org,DIRECT
DOMAIN-SUFFIX,synology.com,DIRECT
DOMAIN-SUFFIX,synology.cn,DIRECT
DOMAIN-SUFFIX,quickconnect.to,DIRECT
DOMAIN-SUFFIX,quickconnect.cn,DIRECT
#
# 【hijack-dns】走代理
IP-CIDR,8.8.8.8/32,PROXY
IP-CIDR,9.9.9.9/32,PROXY
IP-CIDR,1.1.1.1/32,PROXY
# 🏡 LAN
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Lan/Lan.list,DIRECT
# 🧲 PT下载
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Download/Download.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/PrivateTracker/PrivateTracker.list,DIRECT
# 🔖 去广告精简版
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/AdvertisingLite/AdvertisingLite.list,REJECT
# 📚 知乎广告拦截
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/ZhihuAds/ZhihuAds.list,REJECT
# 🎮 Game
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Game/Game.list,DIRECT
# 🍎 Apple
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Apple/Apple.list,DIRECT
DOMAIN-SET,https://github.com/blackmatrix7/ios_rule_script/blob/master/rule/Shadowrocket/Apple/Apple_Domain.list,DIRECT
# 🖥️ Microsoft(不含GitHub)
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Microsoft/Microsoft.list,DIRECT
# 🎬 YouTube
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/YouTube/YouTube.list,PROXY
# 📺 Netflix
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Netflix/Netflix.list,PROXY
# 🎬 Disney+
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Disney/Disney.list,PROXY
# 📲 Telegram
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Telegram/Telegram.list,PROXY
# 🧸 GitHub
# RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/GitHub/GitHub.list,PROXY
# 📟 Google(不含YouTube)(包含在🌏 国外网站/IP合集中)
# RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Google/Google.list,PROXY
# 🌏 GlobalMedia(含YouTube)
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/GlobalMedia/GlobalMedia.list,PROXY
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/GlobalMedia/GlobalMedia_Domain.list,PROXY
# 📽 ChinaMedia
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/ChinaMedia/ChinaMedia.list,DIRECT
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/DouYin/DouYin.list,DIRECT
# 🌏 国外网站/IP合集
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Global/Global.list,PROXY
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/Global/Global_Domain.list,PROXY
# 🇨🇳 国内网站/IP合集
RULE-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/ChinaMax/ChinaMax.list,DIRECT
DOMAIN-SET,https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Shadowrocket/ChinaMax/ChinaMax_Domain.list,DIRECT
# > GeoIP China
GEOIP,CN,DIRECT
# > 匹配失败走代理 规则
FINAL,PROXY
#
###################################################
#
[Host]
# CUSTOM HOST
localhost = 127.0.0.1
#
[URL Rewrite]
# Google搜索引擎防跳转的复写
^https?://(www.)?g.cn https://www.google.com 302
^https?://(www.)?google.cn https://www.google.com 302
#
#
# 一些URL覆写(去广告)
#波点音乐
^http:\/\/bd-api\.kuwo\.cn\/api\/service\/resource\/musicResource\/.+ _ reject
#波点音乐
^https:\/\/bodiancdn\.kuwo\.cn\/.+\.mp4 _ reject
#波点音乐
^http:\/\/bd-api\.kuwo\.cn\/api\/service\/resource\/view\?uid _ reject
#波点音乐
^http:\/\/bd-api\.kuwo\.cn\/api\/service\/music\/recommendList\?uid _ reject
#～BiliBili_哔哩哔哩_屏蔽IP请求@ddgksf2013
^https?:\/\/app\.bilibili\.com\/x\/resource\/ip - reject
#～BiliBili_哔哩哔哩_屏蔽DefaultWord@ddgksf2013
^https?:\/\/app\.bilibili\.com\/bilibili\.app\.interface\.v1\.Search\/Default - reject
#～BiliBili_哔哩哔哩_屏蔽首页右上活动[卸载重装]@ddgksf2013
^https?:\/\/app\.bilibili\.com\/x\/resource\/top\/activity - reject-dict
#～BiliBili_哔哩哔哩_应用开屏去广告@bm7
^https://app.bilibili.com/x/v2/splash/show - reject-dict
#～BiliBili_哔哩哔哩_Defaultword@ddgksf2013
^https://app.bilibili.com/x/v2/search/defaultwords - reject-dict
#～BiliBili_哔哩哔哩_Material_Ad@ddgksf2013
^https?:\/\/api\.bilibili\.com\/x\/vip\/ads\/material\/report - reject-dict
#～BiliBili_哔哩哔哩_小卡片广告@ddgksf2013
^https://api.bilibili.com/pgc/season/player/cards - reject-dict
#～BiliBili_哔哩哔哩_解除SIM卡地区限制
(^https?:\/\/app\.biliintl.com\/intl\/.+)(&sim_code=\d+)(.+)-302$1$3
#～BiliBili_哔哩哔哩_去除搜索中的大家都在搜@bm7
^https?:\/\/api\.vc\.bilibili\.com\/search_svr\/v\d\/Search\/recommend_words - reject
#～BiliBili_哔哩哔哩_去除动态中的话题@bm7
^https?:\/\/api\.vc\.bilibili\.com\/topic_svr\/v1\/topic_svr - reject-dict
#～BiliBili_哔哩哔哩_可能的一些推广(beta)@bm7
^https?:\/\/api\.bilibili\.com\/pgc\/season\/app\/related\/recommend\? - reject-dict
#～BiliBili_哔哩哔哩_漫画去广告@ddgksf2013
^https?:\/\/manga\.bilibili\.com\/twirp\/comic\.v\d\.Comic\/(Flash|ListFlash) - reject-dict
# ～ XiMaLaYa_喜马拉雅_修复轮播Ad失效Bug@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/discovery-feed\/focus\/queryF - reject
# ～ XiMaLaYa_喜马拉雅_播放页_Live@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/mobile-playpage\/view\/ - reject
# ～ XiMaLaYa_喜马拉雅_MyInfo红点提醒@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/chaos-notice-web\/v1\/message\/preview\/list - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽大红包Tips@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/social-web\/bottomTabs\/dynamicEntrance\/status - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽gif弹窗Ad@ddgksf2013
^https?:\/\/.*\.xmcdn\.com\/\w{8}\/\w{4}-\w{16}\/.+gif$ - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽Aged请求@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/(dog-portal\/checkOld|(child-mobile\/child|aged-mobile\/aged)\/mode\/query) - reject
# ～ XiMaLaYa_喜马拉雅_部分Tab弹窗@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/discovery-feed\/isShowUserGiftPendant - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽红点提示@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/mobile-user\/unread - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽minor请求@ddgksf2013
^https?:\/\/.*\.xima.*\.com/mobile-user/minorProtection/pop - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽隐私搜集@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/collector\/xl\/v\d - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽版本更新@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/butler-portal\/versionCheck - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽开屏广告@ddgksf2013
^https?:\/\/(adse\.wsa|adse|adbehavior|xdcs-collector)\.xima.*\.com\/.* - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽位置请求@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/mobile\/discovery\/v\d\/location - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽热搜词@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/hotWord - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽搜索框定时_Ad@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/guideWord - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽实时Ad请求@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/api\/v\d\/adRealTime - reject
# ～ XiMaLaYa_喜马拉雅_屏蔽ting_Ad@ddgksf2013
^https?:\/\/.*\.xima.*\.com\/ting\/(loading|feed|home)? - reject
#
# YouTube去广告，配合下面的脚本使用
#!desc=去除 Youtube 广告 (IOS >= 15)
# > Feature
# 删除 瀑布流、视频、搜索中出现的广告和Shorts
# 删除 Shorts 内的视频广告
# 删除 底部 上传 按钮
# 增加 画中画(PIP), 后台播放 (Beta)
# 增加 自动翻译 (Thanks @VirgilClyne)
#
# > Note
# 广告信息会有遗漏，可能偶现广告
# 该模块已足够全面，无需其他规则混用，防止重写规则被破坏
# 不支持 Mock 的客户端可以用 reject-200/reject-img 替代
^https?:\/\/[\w-]+\.googlevideo\.com\/initplayback.+&oad data="https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/dist/blank.txt" REJECT-200
#
################################################
#
[Script]
# 👍🏻一些脚本（可能一些已经失效）
# 脚本引用自：https://github.com/deezertidal/shadowrocket-rules/tree/main/modules
#
# EmbyPremiere解锁
# EmbyPremiere = type=http-response,script-path=https://raw.githubusercontent.com/rartv/SurgeScript/main/EmbyPremiere/EmbyPremiere.js,pattern=^https?:\/\/mb3admin.com\/admin\/service\/registration\/validateDevice,max-size=131072,requires-body=true,timeout=10,enable=true
EmbyPremiere = type=http-response,script-path=https://gitlab.com/iptv-org/embypublic/-/raw/master/Script/EmbyPremiere.js,pattern=^https?:\/\/mb3admin.com\/admin\/service\/registration\/validateDevice,max-size=131072,requires-body=true,timeout=10,enable=true
APTV=type=http-response,pattern=https://api.revenuecat.com/v1/(receipts|subscribers)/*,requires-body=true,script-path=https://raw.githubusercontent.com/89996462/Quantumult-X/main/ycdz/APTV.js
spotify-proto = type=http-response,pattern=^https:\/\/spclient\.wg\.spotify\.com\/(bootstrap\/v1\/bootstrap|user-customization-service\/v1\/customize)$,requires-body=true,binary-body-mode=1,max-size=0,script-path=https://raw.githubusercontent.com/app2smile/rules/master/js/spotify-proto.js,script-update-interval=0
美图秀秀=type=http-response,pattern=^https?:\/\/(h5|api)\.xiuxiu\.meitu\.com\/v\d\/(h\d\/vip|vip|user)\/,requires-body=true,script-path=https://raw.githubusercontent.com/I-am-R-E/QuantumultX/main/JavaScript/MeiTuXiuXiu.js
Xmind思维导图=type=http-response,pattern=https?:\/\/www\.xmind\.(cn|net|app)\/\_res\/devices,script-path=https://raw.githubusercontent.com/I-am-R-E/Functional-Store-Hub/Master/Xmind/Script/Xmind.js,requires-body=true, timeout=10, tag=Xmind思维导图
电视家=type=http-response,pattern=^http[s]?:\/\/123.56.125.184,requires-body=true,script-path=https://raw.githubusercontent.com/89996462/Quantumult-X/main/ycdz/dsj.js
爱企查vip=type=http-response,pattern=^https:\//aiqicha.baidu.com\/usercenter\/getvipinfoajax,requires-body=true,script-path=https://raw.githubusercontent.com/litieyin/AD_VIP/main/Script/aiqicha.js
YouTubeNoAD = type=http-request,pattern=^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(browse|next|player|reel\/reel_watch_sequence)\?,requires-body=true,max-size=-1,binary-body-mode=1,script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/dist/youtube.request.beta.js
YouTubeNoAD = type=http-response,pattern=^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(browse|next|player|search|reel\/reel_watch_sequence|guide|account\/get_setting)\?,requires-body=true,max-size=-1,binary-body-mode=1,script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/dist/youtube.response.beta.js
#
#
#
[MITM]
# Shadowrocket仅会解密hostname指定的域名的请求，可以使用通配符。也可以使用前缀 - 排除特定主机名，如 -*.example.com。iOS系统和某些应用有严格的安全策略，仅信任某些特定的证书，对这些域名启动解密可能导致问题，如 *.apple.com，*.icloud.com。
hostname = www.google.cn, mb3admin.com, api.revenuecat.com, spclient.wg.spotify.com, h5.xiuxiu.meitu.com, api.xiuxiu.meitu.com, www.xmind.cn, www.xmind.net, www.xmind.app, 123.56.125.184, aiqicha.baidu.com, *.googlevideo.com, youtubei.googleapis.com
#
# 以下为证书参数，可去UI界面自行生成并安装证书，会在此生成对应信息
enable = true
ca-passphrase = 
ca-p12 = 